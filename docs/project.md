## 1. 改訂版 要件定義

### 1.1. プロジェクトの目的

活発な情報交換が行われるDiscordサーバーの会話データを、Model Context Protocol（MCP）を通じてAIが利用可能な形式で提供し、その情報を**整理・調査・解説**することで、ユーザーの知識獲得と理解を支援するAIプラットフォームを構築する。

### 1.2. 機能要件

#### 1.2.1. Discord MCPサーバー

* **Discordデータ連携:**
    * 指定されたDiscordサーバー・チャンネルのメッセージ、スレッド、リアクション、ユーザー情報などを継続的に取得する。
    * リアルタイムまたはニアリアルタイムでのデータ更新を目指す。
* **Model Context Protocol (MCP)準拠:**
    * 取得したDiscordデータをMCPの仕様に沿った形式で提供するAPIエンドポイントを実装する。
    * AIモデルや他のMCPクライアントがDiscordのコンテキストを容易に利用できるようにする。
    * 認証・認可メカニズムを実装し、データアクセスを適切に制御する。
* **データフィルタリング・検索 (MCP経由):**
    * MCPクライアントが期間、チャンネル、ユーザー、キーワードなどで必要な情報を要求できるようにする。

#### 1.2.2. AIプラットフォーム（情報整理・調査・解説機能）

* **情報整理:**
    * 指定された会話やトピック（MCPサーバーから取得）の中から、主要な論点、決定事項、質問、提案などを構造化して抽出・提示する。
    * 会話の流れを時系列やトピック別に整理する。
    * 例: 議論のマインドマップ生成、Q&Aリストの自動作成、重要な発言のハイライト。
* **情報調査:**
    * 会話内で言及された専門用語、固有名詞、概念、URLなどについて、AIが追加情報を調査し、補足情報を提供する。
    * 必要に応じて、信頼できる外部情報源（Web検索結果など）を参照し、その結果を提示する（※セキュリティと正確性に十分注意）。
* **情報解説:**
    * 複雑な議論や技術的な内容について、より平易な言葉で解説を生成する。
    * 会話の背景や文脈を考慮し、初心者にも理解しやすい説明を提供する。
    * 省略された情報や暗黙の前提を補って解説する。
* **要約 (補助的機能):**
    * 長大な会話や議論の概要を簡潔にまとめる（主要な整理・調査・解説機能の補助として）。
* **インタラクション:**
    * ユーザーが特定のメッセージやスレッドを選択し、それに対する整理・調査・解説を要求できる。
    * AIの出力結果に対して、ユーザーがフィードバックを行える（任意）。

#### 1.2.3. ユーザーインターフェース (UI) / 利用方法

* **MCPサーバー利用者向け:**
    * MCPサーバーへの接続情報、APIドキュメントの提供。
* **情報整理・調査・解説機能 利用者向け:**
    * **Discordボット形式:** Discord上で特定のコマンドやメンションを通じてAI機能を利用する。結果はDiscordのチャンネルやスレッド、DMに投稿される。
    * **Webインターフェース (検討):** より詳細な設定や、過去の分析結果の閲覧・検索、体系的な情報整理を行いたい場合に備えて検討。
    * 設定画面: 分析対象のチャンネル選択、通知設定など。

### 1.3. 非機能要件

* **パフォーマンス:**
    * MCPサーバーの応答速度（データ提供のレイテンシ）。
    * AIによる情報整理・調査・解説の処理時間（リアルタイム性が求められるか、バッチ処理で許容されるか）。
* **スケーラビリティ:**
    * 監視対象のDiscordサーバー数、メッセージ量、ユーザー数の増加に対応できるアーキテクチャ。
    * MCPサーバーへの同時アクセス数への対応。
* **セキュリティ:**
    * Discord APIキー、MCPサーバーの認証情報、個人情報・機密情報の厳重な管理。
    * 不正アクセス対策、権限管理。
    * MCPの仕様に準じたセキュアな通信。
* **データの鮮度・正確性:**
    * MCPサーバーが提供するDiscordデータのリアルタイム性。
    * AIによる解説・調査結果の信頼性と正確性。誤情報のリスク低減。
* **プロトコル準拠性:**
    * Model Context Protocolの仕様を正しく実装し、相互運用性を確保する。
* **ユーザビリティ:**
    * （Discordボットの場合）コマンドの分かりやすさ、操作の容易さ。
    * （Web UIの場合）直感的なインターフェース。
* **信頼性・可用性:**
    * システム全体の安定稼働。
* **保守性・拡張性:**
    * MCPサーバー、AIプラットフォーム各機能のモジュール性。
    * 新しいAIモデルへの対応や、分析機能の追加の容易さ。

### 1.4. その他

* **利用するAIモデル:**
    * 情報の整理、調査、解説に適したLLM（GPTシリーズ、Gemini、Claudeなど）の選定。
    * ファインチューニングの要否（特定のドメイン知識に特化させる場合など）。
    * 「調査」機能のためのWeb検索API等との連携。
* **開発体制・期間・予算:**
    * これらを具体化していく。

---

## 2. 設計のポイント（MCPを踏まえて）

### 2.1. システム構成案（改訂版）

```mermaid
graph TD
    subgraph Discord Realm
        DiscordServer[Discord サーバー/チャンネル]
    end

    subgraph MCP Realm
        A[Discord MCPサーバー] -- Model Context Protocol --> B{AIプラットフォーム / MCPクライアント};
        DiscordServer -- Discord API (Bot Token) --> A;
        A -- データ提供 --> C[他のMCP対応AIエージェント/ツール (将来展望)];
    end

    subgraph AI Platform
        B -- 処理要求 --> D(情報整理・調査・解説モジュール);
        D -- 外部情報アクセス --> E[外部API (Web検索等)];
        D -- LLM API --> F[AIモデル (LLM)];
        F -- 結果 --> D;
        D -- 結果 --> G(結果格納DB / キャッシュ);
        G -- データ --> H{ユーザーインターフェース};
        H -- 操作 --> B;
        Users[ユーザー] -- アクセス/コマンド --> H;
    end

    H -- Discord Bot API --> DiscordServer;
```

* **Discord MCPサーバー (A):**
    * Discordからデータを取得し、MCP形式でAPIを提供することに特化します。
    * Python (FastAPI, Flaskなど) で実装し、Discord.pyやそれに類するライブラリでDiscordと連携。
    * データの鮮度を保つための効率的なデータ同期戦略（イベントドリブン、定期的ポーリングなど）が重要です。
* **AIプラットフォーム / MCPクライアント (B):**
    * Discord MCPサーバーから必要なコンテキストを取得します。
    * ユーザーからのリクエスト（例: Discordボットへのコマンド）を解釈し、情報整理・調査・解説モジュール(D)に処理を依頼します。
* **情報整理・調査・解説モジュール (D):**
    * **整理:** テキスト分析技術（固有表現抽出、トピックモデリング、関係抽出など）とLLMを組み合わせて情報を構造化します。
    * **調査:** LLMの知識に加え、必要に応じて外部検索API (E) (例: Google Custom Search API, SerpApiなど) を利用して情報を収集し、検証します。
    * **解説:** LLMに適切なプロンプトを与え、収集・整理した情報に基づいて分かりやすい説明を生成します。プロンプトエンジニアリングが非常に重要です。
* **ユーザーインターフェース (H):**
    * 初期はDiscordボットとしての提供が、ユーザーにとって最も自然な利用方法かもしれません。特定のメッセージにリアクションすることでAI機能を呼び出す、スラッシュコマンドで詳細な指示を出すなどのUIが考えられます。
    * 生成された情報は、スレッドへの返信、ダイレクトメッセージ、あるいは専用の通知チャンネルへの投稿などが考えられます。

### 2.2. 技術選定のポイント（MCPを踏まえて）

* **MCPサーバー実装:**
    * プロトコル仕様を正確に理解し実装する必要があります。Anthropicが提供する資料やコミュニティの動向を注視しましょう。
    * 非同期処理に強いPythonフレームワーク（FastAPIなど）は、多くのI/Oバウンドな処理（Discord API通信、MCPクライアントへの応答）に適しています。
* **AIモデル選定:**
    * 「調査」「解説」といった高度なタスクには、最新かつ高性能なLLMが求められます。特に、外部情報を参照して回答を生成する能力（Retrieval Augmented Generation - RAG のようなアプローチ）や、長文の文脈理解能力が重要になります。
    * コストと性能のバランスを考慮する必要があります。
* **情報調査の信頼性:**
    * AIがWeb検索など外部情報を利用する場合、情報の正確性や出典の明示が非常に重要です。ハルシネーション（もっともらしい嘘の情報）を抑制する工夫が求められます。

### 2.3. 開発ステップ案（MCPを踏まえて）

1.  **Discord MCPサーバーのコア機能開発 (PoC):**
    * 指定したチャンネルのメッセージをMCP形式で提供する最小限のサーバーを構築。
    * 簡単なMCPクライアントを作成し、接続とデータ取得を確認。
2.  **基本的なAI解説機能の実装:**
    * MCPサーバーから取得した短い会話に対して、LLMを用いて簡単な解説を生成する機能をDiscordボットとして実装。
3.  **情報整理・調査機能の段階的追加:**
    * まずはキーワード抽出やトピック分類などの基本的な整理機能を追加。
    * 次に、限定的な範囲での外部情報検索と組み合わせた調査・解説機能を開発。
4.  **MCPサーバーの機能拡充と堅牢化:**
    * リアルタイム性向上、フィルタリング機能の充実、認証・認可の強化。
5.  **高度なAI機能とUIの改善:**
    * より複雑な情報整理（マインドマップ等）、ユーザーフィードバック機構、Web UI（必要に応じて）などを開発。
6.  **テスト・評価・改善:**
    * MCP準拠テスト、AIの出力品質評価、ユーザビリティテストを継続的に実施。
